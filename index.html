<html>
<head>
<script src="/assets/js/common.js"></script>
<script src="/assets/js/oyoProProtocol.js"></script>
<script src="https://www.moneybutton.com/moneybutton.js"></script>
<script type="text/javascript" src="https://unpkg.com/bsv@0.27.2/bsv.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.5/css/bulma.min.css">
<link rel="stylesheet" href="/assets/css/styles.css">
</head>
<body>
<div class="container is-fluid">
  <div id="nav"></div>

  <div class="tile is-ancestor">
    <div class="tile is-parent is-6">
      <article class="tile is-child box">
        <p class="title">Directory</p>
        <div class="tabs">
          <ul>
            <li id="defaultSelect" class="is-active">
              <a href="javascript:void(0)" onclick="changeType('default')">
                Explorers
              </a>
            <li id="baseProtocolSelect">
              <a href="javascript:void(0)" onclick="changeType('baseProtocol')">
                Protocols
              </a>
            </li>
            <li id="mapAppSelect">
              <a href="javascript:void(0)" onclick="changeType('mapApp')">
                Apps
              </a>
            </li>
          </ul>
        </div>
        <div class="content">
          <div id='typeRanking'></div>
        </div>
      </article>
    </div>
    <div class="tile is-parent">
      <article class="tile is-child box">
        <p class="title">Ranking</p>
        <p class="subtitle"><span id="type"></span> <span id="appName"></span></p>
        <div class="content">
          <div id='ranking'></div>
        </div>
      </article>
    </div>
  </div>

  </div>

<script language='javascript'>
  let address = window.bitcomAddress
  let type = getUrlVars()["type"] || "default"
  let appName
  if (type === "default") {
    appName = "default"
  }
  let appUrl
  let amount
  let endTimestamp = parseInt(new Date().getTime() / 1000)
  let beginTimestamp = parseInt(endTimestamp - window.rankingPeriod)
  var renderAll = function() {
      getRankings(address, type, appName, appUrl, beginTimestamp, endTimestamp).then(function(items) {
        renderRankingUrls(type, items, "ranking")
        document.getElementById("type").innerHTML = type + ": ";
        document.getElementById("appName").innerHTML = appName;
      })
  }
  var changeType = function(newType) {
    type = newType
    appName = ""
    if (type === "default") {
      appName = "default"
    }
    document.getElementById("defaultSelect").classList.remove("is-active");
    document.getElementById("baseProtocolSelect").classList.remove("is-active");
    document.getElementById("mapAppSelect").classList.remove("is-active");
    document.getElementById(type + "Select").classList.add("is-active");
    document.getElementById("ranking").innerHTML = ""
    document.getElementById("type").innerHTML = "";
    document.getElementById("appName").innerHTML = "";
    getTypeRankings(address, type, beginTimestamp, endTimestamp).then(function(items) {
      renderRankingNames(type, items, "typeRanking")
    })
    .catch(error => {
      console.log(error)
    })

    renderAll()
  }
  var changeApp = function(newAppName) {
    appName = newAppName
    renderAll()
  }
  document.addEventListener("DOMContentLoaded", function() {
    loadNav()
    // initiate ranking on load
    changeType("default")
    renderAll()
  })
</script>
</body>
</html>
